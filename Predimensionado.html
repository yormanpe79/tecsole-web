<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Solar Expert - Colombia 2025</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Calculadora Solar Profesional Colombia - Simula tu proyecto fotovoltaico CREG 174. Calcula retorno de inversión, ahorro energético, TIR y proyección financiera a 25 años. Diseño por Yorman Peralta, Ingeniero Electricista.">
    <meta name="keywords"
        content="calculadora solar, fotovoltaica Colombia, CREG 174, retorno inversión solar, dimensionamiento solar, cotizador solar, paneles solares Colombia">
    <meta name="author" content="Yorman Peralta García">
    <link rel="canonical" href="https://www.tecsole.com/Predimensionado.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.tecsole.com/Predimensionado.html">
    <meta property="og:title" content="Calculadora Solar Expert - Retorno de Inversión">
    <meta property="og:description"
        content="Simula tu proyecto solar fotovoltaico en Colombia. Calcula retorno de inversión, TIR y ahorro energético bajo CREG 174.">
    <meta property="og:image" content="https://www.tecsole.com/Logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.tecsole.com/Predimensionado.html">
    <meta property="twitter:title" content="Calculadora Solar Expert - Colombia">
    <meta property="twitter:description"
        content="Calcula el retorno de tu inversión solar con nuestra herramienta profesional.">
    <meta property="twitter:image" content="https://www.tecsole.com/Logo.png">

    <!-- PWA / Mobile -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="Logo.png">
    <link rel="apple-touch-icon" href="Logo.png">

    <!-- Scripts and Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@600;700;800&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary: #0f172a;
            --accent: #f59e0b;
            --bg-page: #f8fafc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: #334155;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        h1,
        h2,
        h3,
        h4,
        .font-heading {
            font-family: 'Montserrat', sans-serif;
        }

        .excel-input {
            transition: all 0.2s;
            border: 1px solid #cbd5e1;
            font-size: 0.9rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            width: 100%;
            background-color: #fff;
        }

        .excel-input:focus {
            border-color: var(--accent);
            outline: 2px solid #fde68a;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: var(--accent);
            border: 2px solid white;
            cursor: pointer;
            margin-top: -7px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        .kpi-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Animación suave para el marranito */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-3px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .piggy-animate {
            animation: float 3s ease-in-out infinite;
        }

        @media print {
            @page {
                margin: 0.8cm;
                size: letter;
            }

            body {
                background: white;
                font-size: 9pt;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }

            .page-break {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            .break-after {
                page-break-after: always;
            }

            .main-grid {
                display: block !important;
            }

            .col-span-8 {
                width: 100% !important;
            }

            canvas {
                max-height: 250px !important;
                width: 100% !important;
            }

            .header-print {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 4px solid var(--primary);
                padding-bottom: 20px;
                margin-bottom: 30px;
            }

            /* --- CORRECCIÓN BUG IMPRESIÓN TABLA --- */
            /* 1. Forzar visibilidad del desbordamiento para que no corte la tabla */
            .overflow-x-auto,
            .overflow-hidden {
                overflow: visible !important;
                display: block !important;
            }

            /* 2. Ajustes de la tabla para que quepa y pagíné bien */
            table {
                width: 100% !important;
                border-collapse: collapse;
                page-break-inside: auto;
            }

            thead {
                display: table-header-group;
            }

            /* Repite encabezados en nueva página */
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            /* Evita cortar filas por la mitad */

            /* 3. Reducir fuente y espaciado para asegurar que quepan todas las columnas */
            th,
            td {
                font-size: 7pt !important;
                padding: 4px 2px !important;
                white-space: nowrap;
                /* Evita que el texto se rompa en varias lineas si no es necesario */
            }

            /* 4. Limpiar estilos de contenedores que estorban en impresión */
            .shadow-sm {
                box-shadow: none !important;
            }

            .border {
                border: 1px solid #eee !important;
            }
        }

        .print-only {
            display: none;
        }

        /* ===== RESPONSIVE MOBILE STYLES ===== */
        @media (max-width: 768px) {

            /* Navigation Mobile */
            nav {
                padding: 12px 3% !important;
            }

            nav .container {
                flex-direction: column;
                gap: 12px;
            }

            nav .flex.items-center.gap-3:first-child {
                width: 100%;
                justify-content: center;
            }

            nav .flex.items-center.gap-3:last-child {
                width: 100%;
                flex-direction: column;
                gap: 8px;
            }

            nav a,
            nav button {
                width: 100%;
                justify-content: center;
                font-size: 0.8rem !important;
                padding: 10px 15px !important;
            }

            /* Main Grid Mobile */
            .main-grid {
                grid-template-columns: 1fr !important;
                gap: 20px;
            }

            /* Form Section Mobile */
            .bg-white.p-5 {
                padding: 1rem !important;
            }

            .space-y-4>div,
            .space-y-3>div {
                margin-bottom: 0.75rem;
            }

            .grid.grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 0.75rem;
            }

            /* KPI Cards Mobile */
            .grid.grid-cols-1.md\\:grid-cols-3 {
                grid-template-columns: 1fr !important;
            }

            .kpi-card {
                padding: 1.25rem !important;
            }

            .kpi-card h2 {
                font-size: 1.75rem !important;
            }

            .kpi-card p {
                font-size: 0.8rem !important;
            }

            /* Charts Mobile */
            .h-64 {
                height: 250px !important;
            }

            canvas {
                max-height: 250px !important;
            }

            /* Factura Analysis Grid Mobile */
            .grid.grid-cols-1.md\\:grid-cols-2 {
                grid-template-columns: 1fr !important;
            }

            .grid.grid-cols-2.gap-4 {
                grid-template-columns: 1fr !important;
            }

            /* Savings Card Mobile */
            .bg-gradient-to-r {
                padding: 1.25rem !important;
            }

            /* Environmental Impact Mobile */
            .bg-gradient-to-r.from-green-50 {
                flex-direction: column !important;
                gap: 15px !important;
                padding: 1.5rem !important;
            }

            .border-l {
                border-left: none !important;
                border-top: 1px solid #d1fae5 !important;
                padding-top: 15px !important;
                padding-left: 0 !important;
            }

            /* Table Mobile */
            table {
                font-size: 0.7rem !important;
            }

            th,
            td {
                padding: 6px 3px !important;
                font-size: 0.65rem !important;
            }

            /* Titles Mobile */
            h1 {
                font-size: 1.25rem !important;
            }

            h2 {
                font-size: 1.1rem !important;
            }

            h3 {
                font-size: 1rem !important;
            }

            h4 {
                font-size: 0.9rem !important;
            }

            /* Input Fields Mobile */
            .excel-input {
                font-size: 0.85rem !important;
                padding: 0.4rem !important;
            }

            select,
            input[type="number"] {
                font-size: 0.85rem !important;
            }

            /* Labels Mobile */
            label {
                font-size: 0.7rem !important;
            }

            /* Buttons Mobile */
            button {
                padding: 10px 15px !important;
                font-size: 0.85rem !important;
            }

            /* Container Padding Mobile */
            .container {
                padding-left: 12px !important;
                padding-right: 12px !important;
            }

            .px-4 {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }

            .p-6 {
                padding: 1.25rem !important;
            }

            /* Spacing Mobile */
            .space-y-6>*+* {
                margin-top: 1.25rem !important;
            }

            .gap-6 {
                gap: 1rem !important;
            }

            .gap-8 {
                gap: 1.25rem !important;
            }
        }

        /* Tablet Responsive (769px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr !important;
            }

            .lg\\:col-span-4,
            .lg\\:col-span-8 {
                grid-column: span 1 !important;
            }

            nav .container {
                padding-left: 2rem;
                padding-right: 2rem;
            }
        }

        /* Small Mobile (max-width: 480px) */
        @media (max-width: 480px) {
            nav h1 {
                font-size: 0.95rem !important;
            }

            nav p {
                font-size: 0.55rem !important;
            }

            .kpi-card h2 {
                font-size: 1.5rem !important;
            }

            .text-3xl {
                font-size: 1.5rem !important;
            }

            .text-2xl {
                font-size: 1.25rem !important;
            }

            .text-xl {
                font-size: 1rem !important;
            }

            .text-lg {
                font-size: 0.95rem !important;
            }

            table {
                font-size: 0.6rem !important;
            }

            th,
            td {
                padding: 4px 2px !important;
                font-size: 0.6rem !important;
            }

            /* Hide some columns on very small screens */
            #colDeuda {
                display: none !important;
            }
        }
    </style>
</head>

<body class="pb-12">

    <div class="print-only header-print">
        <div class="flex items-center gap-4">
            <i class="fas fa-solar-panel text-4xl text-yellow-500"></i>
            <div>
                <h1 class="text-2xl font-heading font-extrabold text-slate-800">PROPUESTA TÉCNICA Y FINANCIERA</h1>
                <p class="text-sm text-gray-500">Proyecto Solar Fotovoltaico (CREG 174)</p>
            </div>
        </div>
        <div class="text-right">
            <p class="font-bold text-lg">Cotización: <span id="quoteId"></span></p>
            <p class="text-sm text-gray-600">Fecha: <span id="printDate"></span></p>
        </div>
    </div>

    <nav class="bg-white text-slate-900 p-4 shadow-xl mb-6 no-print sticky top-0 z-50 border-b-4 border-yellow-500"
        style="background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-yellow-500 p-2 rounded-lg text-slate-900"><i class="fas fa-sun text-xl"></i></div>
                <div>
                    <h1 class="font-heading font-bold text-lg leading-none text-slate-900">Solar Expert Colombia</h1>
                    <p class="text-[10px] text-slate-500">Calculadora de Retorno de Inversión v1.0</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <a href="index.html"
                    class="bg-transparent hover:bg-slate-900 border border-slate-900 hover:text-white text-slate-900 px-4 py-2 rounded-lg shadow-lg transition flex items-center gap-2 text-sm"
                    title="Volver a página principal">
                    <i class="fas fa-home text-lg"></i>
                </a>
                <a href="Manual_Usuario_SolarExpert.pdf" download
                    class="bg-transparent hover:bg-slate-900 border border-slate-900 hover:text-white text-slate-900 px-4 py-2 rounded-lg font-semibold shadow-lg transition flex items-center gap-2 text-sm"
                    title="Descargar Manual de Uso">
                    <i class="fas fa-book"></i> Manual de Uso
                </a>
                <button type="button" onclick="printPage()"
                    class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 px-5 py-2 rounded-lg font-bold shadow-lg transition inline-flex items-center gap-2 text-sm">
                    <i class="fas fa-file-pdf"></i> PDF / Imprimir
                </button>
            </div>
        </div>
    </nav>


    <div class="container mx-auto px-4 lg:px-8 grid grid-cols-1 lg:grid-cols-12 gap-6 main-grid">

        <div class="lg:col-span-4 space-y-5 no-print">
            <form id="solarForm" oninput="calcularDimensionado()">

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">1. Perfil de Consumo</h3>
                        <i class="fas fa-bolt text-yellow-500 bg-yellow-100 p-1.5 rounded-full"></i>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Tipo de Usuario</label>
                            <select id="tipoCliente" class="excel-input font-medium text-slate-700"
                                onchange="calcularDimensionado()">
                                <option value="res1">Residencial Estrato 1-3 (Subsidio)</option>
                                <option value="res4" selected>Residencial Estrato 4 (Plena)</option>
                                <option value="res5">Residencial Estrato 5-6 (+20% Contrib.)</option>
                                <option value="com">Comercial (+20% Contrib.)</option>
                                <option value="ind">Industrial (+20% Contrib.)</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Consumo Promedio (kWh/mes)</label>
                            <input type="number" id="consumoMensual" value="1200" min="0"
                                class="excel-input bg-yellow-50 font-bold text-lg text-slate-800">
                            <p class="text-[10px] text-gray-400 mt-1">Revise el promedio de los últimos 6 meses en su
                                factura.</p>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-bold text-slate-500">Tarifa (COP/kWh)</label>
                                <input type="number" id="tarifa" value="900" class="excel-input">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500">Comercializacion ($/kWh)</label>
                                <input type="number" id="costoComp" value="200" class="excel-input"
                                    title="Valor que descuenta el operador por comercializar">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-slate-500">Aseo y Alumbrado ($)</label>
                            <input type="number" id="costoAseo" value="55000"
                                class="excel-input bg-orange-50 border-orange-200">
                        </div>

                        <div class="pt-3 border-t border-dashed border-gray-300">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-bold text-blue-800">% Autoconsumo</label>
                                <span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-0.5 rounded"
                                    id="lblAutoconsumo">60%</span>
                            </div>
                            <input type="range" id="pctAutoconsumo" min="0" max="100" value="60" step="5">
                            <div class="flex justify-between text-[10px] text-gray-400 mt-1">
                                <span>Exportación Total (Créditos de Energia)</span>
                                <span>Consumo Total</span>
                            </div>
                        </div>


                    </div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">2. Ingeniería</h3>
                        <i class="fas fa-tools text-blue-500 bg-blue-100 p-1.5 rounded-full"></i>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-slate-500">Ubicación (HSP - Atlas IDEAM)</label>
                            <select id="regionHSP" class="excel-input" onchange="updateHSP()">
                                <option value="6.0">Región Caribe Alta (Guajira) - 6.0</option>
                                <option value="5.5">Costa Atlántica (Santa Marta) - 5.5</option>
                                <option value="5.2">Barranquilla / Cartagena - 5.2</option>
                                <option value="5.1">Huila / Tolima - 5.1</option>
                                <option value="4.8">Valle del Cauca - 4.8</option>
                                <option value="4.6" selected>Antioquia / Eje Cafetero - 4.6</option>
                                <option value="4.4">Llanos Orientales - 4.4</option>
                                <option value="4.2">Bogotá / Cundinamarca - 4.2</option>
                                <option value="3.8">Nariño / Sur - 3.8</option>
                            </select>
                            <input type="hidden" id="hsp" value="4.6">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500">Tecnología</label>
                            <select id="tipoTecnologia" class="excel-input" onchange="calcularDimensionado()">
                                <option value="string">Inversor Central (String)</option>
                                <option value="micro">Microinversores (MLPE)</option>
                                <option value="hibrido">Híbrido + Batería LFP</option>
                            </select>
                            <p id="txtPrecioRef" class="text-[10px] text-green-600 mt-1 text-right font-bold"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">3. Parámetros Financieros</h3>
                        <i class="fas fa-coins text-green-500 bg-green-100 p-1.5 rounded-full"></i>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase">Modalidad de Pago</label>
                            <select id="tipoFinanciamiento" class="excel-input" onchange="toggleFinanciamiento()">
                                <option value="propio" selected>Recursos Propios (Cash)</option>
                                <option value="credito">Crédito Bancario</option>
                            </select>
                        </div>

                        <div id="divCredito"
                            class="hidden bg-slate-50 p-3 rounded-lg border border-slate-200 transition-all">
                            <div class="grid grid-cols-2 gap-2 mb-2">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500">% Financiado</label>
                                    <input type="number" id="pctFinanciado" value="80" class="excel-input text-xs">
                                </div>
                                <div>
                                    <label class="text-[10px] font-bold text-slate-500">Tasa E.A. %</label>
                                    <input type="number" id="tasaInteres" value="22" class="excel-input text-xs">
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500">Plazo Crédito: <span
                                        id="lblPlazo">5</span> Años</label>
                                <input type="range" id="plazoCredito" min="1" max="10" value="5" step="1"
                                    oninput="document.getElementById('lblPlazo').innerText=this.value; calcularDimensionado();">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-bold text-slate-500">Incremento Tarifa (%/Año)</label>
                                <input type="number" id="incremento" value="8" class="excel-input">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500">IPC (Inflación %/Año)</label>
                                <input type="number" id="ipc" value="5" class="excel-input">
                            </div>
                        </div>

                        <div class="bg-green-50 p-3 rounded-lg border border-green-100">
                            <div class="flex items-center gap-2 mb-2">
                                <input type="checkbox" id="checkIncentivos" checked
                                    class="h-4 w-4 text-green-600 rounded">
                                <label class="text-xs font-bold text-green-800">Incentivos Ley 1715</label>
                            </div>
                            <div id="divIncentivos" class="grid grid-cols-2 gap-2">
                                <div><label class="text-[10px] text-green-700 font-bold">Renta %</label><input
                                        type="number" id="tasaImpuesto" value="35" class="excel-input text-xs h-8">
                                </div>
                                <div><label class="text-[10px] text-green-700 font-bold">Años Recup.</label><input
                                        type="number" id="anosDeduc" value="5" class="excel-input text-xs h-8"></div>
                            </div>
                            <p class="text-[9px] text-green-700 mt-1 leading-tight text-justify">
                                *Calcula Deducción Especial (50%) + Depreciación Acelerada. Total escudo fiscal aprox
                                52.5% de la inversión.
                            </p>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="lg:col-span-8 space-y-6">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="kpi-card p-5 rounded-xl border-l-4 border-yellow-400">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Sistema Solar</p>
                            <h2 class="text-3xl font-bold text-slate-800" id="resPotencia">0 kWp</h2>
                            <p class="text-sm text-slate-600 mt-1"><i class="fas fa-th mr-1 text-yellow-500"></i> <span
                                    id="resPaneles">0</span> Módulos 580W</p>
                        </div>
                        <i class="fas fa-sun text-2xl text-yellow-200"></i>
                    </div>
                </div>

                <div class="kpi-card p-5 rounded-xl border-l-4 border-green-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Retorno (Payback)</p>
                            <h2 class="text-3xl font-bold text-green-700" id="resPayback">0 Años</h2>
                            <p class="text-sm text-slate-600 mt-1">TIR Financiera: <span id="resTIR"
                                    class="bg-green-100 text-green-800 px-1 rounded font-bold">0%</span></p>
                        </div>
                        <i class="fas fa-chart-line text-2xl text-green-200"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 page-break">
                <h3 class="font-heading font-bold text-lg text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fas fa-file-invoice-dollar text-blue-600"></i> Análisis de Facturación (CREG 174)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="relative h-64 w-full"><canvas id="chartFactura"></canvas></div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 rounded-lg border bg-blue-50 text-center">
                                <p class="text-xs text-blue-600 font-bold uppercase mb-1">Autoconsumo</p>
                                <p class="text-lg font-extrabold text-blue-900" id="valAutoconsumo">$0</p>
                                <p class="text-[9px] text-blue-400">Deja de comprar a red</p>
                            </div>
                            <div class="p-3 rounded-lg border bg-orange-50 text-center">
                                <p class="text-xs text-orange-600 font-bold uppercase mb-1">Excedentes</p>
                                <p class="text-lg font-extrabold text-orange-900" id="valExcedentes">$0</p>
                                <p class="text-[9px] text-orange-400">Créditos de Energía</p>
                            </div>
                        </div>

                        <div
                            class="bg-gradient-to-r from-slate-900 to-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 relative overflow-hidden group">
                            <div
                                class="absolute right-[-15px] top-[-10px] text-yellow-500/10 text-8xl transform rotate-12 z-0">
                                <i class="fas fa-piggy-bank"></i>
                            </div>

                            <div class="relative z-10 flex justify-between items-center">
                                <div>
                                    <p
                                        class="text-xs text-slate-400 uppercase font-bold tracking-wider mb-2 whitespace-nowrap">
                                        Ahorro Mensual Total</p>
                                    <div class="flex items-center gap-2">
                                        <div class="text-emerald-400 text-xs font-bold flex items-center gap-1">
                                            <span id="valPctAhorro">0%</span>
                                        </div>
                                        <span class="text-[10px] text-slate-400">Reducción Factura</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="flex justify-end mb-1">
                                        <i class="fas fa-piggy-bank text-yellow-400 text-xl piggy-animate"></i>
                                    </div>
                                    <p class="text-3xl font-extrabold text-yellow-400 tracking-tight"
                                        id="valAhorroTotal">$0</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center text-xs border-t pt-3">
                            <div class="text-gray-500">Factura Actual: <strong id="valFacturaActual"
                                    class="text-slate-700 text-sm">$0</strong></div>
                            <i class="fas fa-arrow-right text-gray-300"></i>
                            <div class="text-gray-500">Nueva Factura: <strong id="valFacturaNueva"
                                    class="text-green-600 text-sm">$0</strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-100 flex justify-around items-center page-break">
                <div class="text-center">
                    <div
                        class="bg-white w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-2 text-green-600 text-xl">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h4 class="font-bold text-slate-700">Impacto Ambiental</h4>
                </div>
                <div class="text-center border-l border-green-200 pl-8">
                    <p class="text-3xl font-bold text-emerald-700" id="resCO2">0</p>
                    <p class="text-xs font-bold text-emerald-600 uppercase">Ton CO2 Evitadas</p>
                </div>
                <div class="text-center border-l border-green-200 pl-8">
                    <p class="text-3xl font-bold text-emerald-700" id="resArboles">0</p>
                    <p class="text-xs font-bold text-emerald-600 uppercase">Árboles Plantados</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 page-break">
                <h3 class="font-heading font-bold text-lg text-slate-800 mb-2">Flujo de Caja Acumulado (25 Años)</h3>
                <div class="h-64 w-full"><canvas id="chartFlujo"></canvas></div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 overflow-hidden break-after">
                <h3 class="font-heading font-bold text-slate-800 mb-4 text-sm uppercase">Detalle Financiero (Proyección
                    25 Años)</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs text-right border-collapse">
                        <thead class="bg-slate-50 text-slate-600 uppercase font-semibold border-b border-slate-200">
                            <tr>
                                <th class="p-3 text-center">Año</th>
                                <th class="p-3">Ahorro Energía</th>
                                <th class="p-3 text-green-700 bg-green-50">Benef. Trib.</th>
                                <th class="p-3 text-red-600">O&M</th>
                                <th class="p-3 text-red-600 bg-red-50" id="colDeuda">Pago Deuda</th>
                                <th class="p-3 font-bold bg-slate-100">Flujo Neto</th>
                                <th class="p-3 font-bold">Acumulado</th>
                            </tr>
                        </thead>
                        <tbody id="tablaBody" class="text-slate-600 divide-y divide-slate-100"></tbody>
                    </table>
                </div>
                <p class="text-[10px] text-gray-400 mt-3 italic">* Estudio preliminar sujeto a visita técnica.</p>
            </div>

            <div class="print-only mt-8 pt-8 border-t-2 border-gray-200">
                <div class="grid grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold text-sm mb-2">Notas:</h4>
                        <ul class="text-[10px] text-gray-600 list-disc list-inside space-y-1">
                            <li>Oferta preliminar sujeta a visita técnica.</li>
                            <li>Generación estimada con base en Atlas IDEAM.</li>
                            <li>Garantía Paneles: 25 años potencia lineal.</li>
                            <li>Garantía Inversor: 10 años estándar.</li>
                        </ul>
                    </div>
                    <div class="flex flex-col justify-end text-center">
                        <div class="border-b border-black w-3/4 mx-auto mb-2"></div>
                        <p class="text-xs font-bold">Aprobado Cliente</p>
                        <p class="text-[10px] text-gray-500">CC / NIT:</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const formatCOP = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
        let chartFlujoInstance = null, chartFacturaInstance = null;

        // MATRIZ DE PRECIOS CALIBRADA 2025 (COP/kWp)
        const PRECIOS_BASE = {
            string: { small: 3950000, medium: 3350000, large: 2950000 },
            micro: { small: 4850000, medium: 4400000, large: 4100000 },
            hibrido: { small: 6600000, medium: 6100000, large: 5700000 }
        };

        function generateId() {
            document.getElementById('quoteId').innerText = 'COT-' + new Date().getFullYear() + '-' + Math.floor(Math.random() * 10000);
            const d = new Date();
            const meses = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
            document.getElementById('printDate').innerText = `${d.getDate()} / ${meses[d.getMonth()]} / ${d.getFullYear()}`;
        }

        function updateHSP() {
            document.getElementById('hsp').value = document.getElementById('regionHSP').value;
            calcularDimensionado();
        }

        function toggleFinanciamiento() {
            const tipo = document.getElementById('tipoFinanciamiento').value;
            const div = document.getElementById('divCredito');
            if (tipo === 'credito') {
                div.classList.remove('hidden');
                document.getElementById('colDeuda').style.display = 'table-cell';
            } else {
                div.classList.add('hidden');
                document.getElementById('colDeuda').style.display = 'none';
            }
            calcularDimensionado();
        }

        function calculateIRR(values, guess = 0.1) {
            const maxIter = 1000; let rate = guess;
            for (let i = 0; i < maxIter; i++) {
                let npv = 0, dNpv = 0;
                for (let t = 0; t < values.length; t++) {
                    npv += values[t] / Math.pow(1 + rate, t);
                    dNpv -= t * values[t] / Math.pow(1 + rate, t + 1);
                }
                let newRate = rate - npv / dNpv;
                if (Math.abs(newRate - rate) < 1e-7) return newRate;
                rate = newRate;
            }
            return 0;
        }

        function calcularDimensionado() {
            // INPUTS
            const consumoMes = parseFloat(document.getElementById('consumoMensual').value) || 0;
            const tarifa = parseFloat(document.getElementById('tarifa').value) || 0;
            const costoComp = parseFloat(document.getElementById('costoComp').value) || 0;
            const costoFijo = parseFloat(document.getElementById('costoAseo').value) || 0;
            let pctAutoconsumo = parseFloat(document.getElementById('pctAutoconsumo').value) / 100;
            const hsp = parseFloat(document.getElementById('hsp').value);
            const tipoTecnologia = document.getElementById('tipoTecnologia').value;
            const tipoCliente = document.getElementById('tipoCliente').value;

            // Financieros
            const tipoFin = document.getElementById('tipoFinanciamiento').value;
            const infE = parseFloat(document.getElementById('incremento').value) / 100;
            const ipc = parseFloat(document.getElementById('ipc').value) / 100;
            const applyTax = document.getElementById('checkIncentivos').checked;
            const taxRate = parseFloat(document.getElementById('tasaImpuesto').value) / 100;
            const anosDeduc = parseFloat(document.getElementById('anosDeduc').value);

            // Contribución
            const pagaContrib = ['res5', 'com', 'ind'].includes(tipoCliente);
            const tasaContrib = pagaContrib ? 0.20 : 0.0;

            document.getElementById('lblAutoconsumo').innerText = (pctAutoconsumo * 100).toFixed(0) + '%';
            if (tipoTecnologia === 'hibrido' && pctAutoconsumo < 0.9) { pctAutoconsumo = 0.95; document.getElementById('pctAutoconsumo').value = 95; }

            // DIMENSIONAMIENTO
            const panelW = 580;
            const pr = tipoTecnologia === 'micro' ? 0.82 : 0.78;
            const genEspecifica = hsp * 365 * pr;
            const potReq = (consumoMes * 12) / genEspecifica;
            const numPaneles = Math.ceil((potReq * 1000) / panelW);
            const potInstaladaKw = (numPaneles * panelW) / 1000;
            const genAnual = potInstaladaKw * genEspecifica;

            // CAPEX
            let costoUnitario = 0;
            const preciosTec = PRECIOS_BASE[tipoTecnologia];
            if (potInstaladaKw < 6) costoUnitario = preciosTec.small;
            else if (potInstaladaKw < 20) costoUnitario = preciosTec.medium;
            else costoUnitario = preciosTec.large;
            const inversion = potInstaladaKw * costoUnitario;
            document.getElementById('txtPrecioRef').innerText = `Ref: ${formatCOP.format(costoUnitario)}/kWp`;

            // FINANCIACIÓN
            let flujoInicial = -inversion;
            let cuotaAnualDeuda = 0;
            let plazoDeuda = 0;
            let equity = inversion;

            if (tipoFin === 'credito') {
                const pctFin = parseFloat(document.getElementById('pctFinanciado').value) / 100;
                const tasaEA = parseFloat(document.getElementById('tasaInteres').value) / 100;
                plazoDeuda = parseFloat(document.getElementById('plazoCredito').value);

                const montoDeuda = inversion * pctFin;
                equity = inversion - montoDeuda;
                flujoInicial = -equity; // El cliente solo desembolsa la cuota inicial

                // PMT Cálculo
                const tasaMes = Math.pow(1 + tasaEA, 1 / 12) - 1;
                const nMeses = plazoDeuda * 12;
                const cuotaMes = (montoDeuda * tasaMes) / (1 - Math.pow(1 + tasaMes, -nMeses));
                cuotaAnualDeuda = cuotaMes * 12;

                // Mostrar Info Crédito
                // Mostrar Info Crédito (Removed from UI)
                // document.getElementById('infoCredito').classList.remove('hidden');
                // document.getElementById('valEquity').innerText = formatCOP.format(equity);
                // document.getElementById('valCuota').innerText = formatCOP.format(cuotaMes);
            } else {
                // document.getElementById('infoCredito').classList.add('hidden');
            }

            // FLUJO DE CAJA
            let flujos = [flujoInicial];
            let acumulado = flujoInicial;
            let htmlTabla = '';
            let dataAcum = [acumulado];
            let payback = 0;

            // Datos Factura Año 1
            let ahorroMes1Auto = 0, ahorroMes1Exc = 0, facturaActual1 = 0, facturaNueva1 = 0;

            const totalBeneficioFiscal = applyTax ? (inversion * 1.5 * taxRate) : 0;
            const beneficioAnual = totalBeneficioFiscal / anosDeduc;

            for (let t = 1; t <= 25; t++) {
                let genT = genAnual * Math.pow(1 - 0.0055, t - 1);
                let tarifaT = tarifa * Math.pow(1 + infE, t - 1);
                let costoCompT = costoComp * Math.pow(1 + infE, t - 1);

                // --- Ahorros ---
                let energiaAuto = genT * pctAutoconsumo;
                let energiaExc = genT * (1 - pctAutoconsumo);

                let valAuto = energiaAuto * tarifaT * (1 + tasaContrib);
                let valExc = energiaExc * Math.max(0, tarifaT - costoCompT); // Sin contribución
                let ahorroTotalAnual = valAuto + valExc;

                // --- Facturación Visual Año 1 ---
                if (t === 1) {
                    let facBase = ((consumoMes * 12) * tarifaT * (1 + tasaContrib)) + (costoFijo * 12);
                    let consumoRedNeto = Math.max(0, (consumoMes * 12) - energiaAuto);
                    let facNueva = (consumoRedNeto * tarifaT * (1 + tasaContrib)) - valExc + (costoFijo * 12);

                    ahorroMes1Auto = valAuto / 12; ahorroMes1Exc = valExc / 12;
                    facturaActual1 = facBase / 12; facturaNueva1 = Math.max(costoFijo, facNueva / 12);
                }

                // --- Egresos ---
                let mant = (inversion * 0.01) * Math.pow(1 + ipc, t - 1);
                if (t === 12 && tipoTecnologia === 'string') mant += (inversion * 0.10) * Math.pow(1 + ipc, t - 1);
                if (t === 12 && tipoTecnologia === 'hibrido') mant += (inversion * 0.25) * Math.pow(1 + ipc, t - 1);

                // --- Deuda ---
                let pagoDeuda = (tipoFin === 'credito' && t <= plazoDeuda) ? cuotaAnualDeuda : 0;

                // --- Beneficios ---
                let benefT = (applyTax && t <= anosDeduc) ? beneficioAnual : 0;

                let flujoNeto = ahorroTotalAnual - mant - pagoDeuda + benefT;
                acumulado += flujoNeto;

                flujos.push(flujoNeto);
                dataAcum.push(acumulado);

                if (payback === 0 && acumulado >= 0) {
                    let prev = dataAcum[t - 1];
                    payback = (t - 1) + (Math.abs(prev) / flujoNeto);
                }

                // Render Tabla Completa (25 Años)
                let styleDeuda = tipoFin === 'credito' ? '' : 'display:none';
                htmlTabla += `<tr class="border-b hover:bg-gray-50">
                    <td class="p-3 text-center font-bold text-gray-500">${t}</td>
                    <td class="p-3 text-blue-700">${formatCOP.format(ahorroTotalAnual)}</td>
                    <td class="p-3 text-green-600 bg-green-50 text-[10px]">+${formatCOP.format(benefT)}</td>
                    <td class="p-3 text-red-500 text-[10px]">-${formatCOP.format(mant)}</td>
                    <td class="p-3 text-red-600 bg-red-50 text-[10px]" style="${styleDeuda}">-${formatCOP.format(pagoDeuda)}</td>
                    <td class="p-3 font-bold text-slate-700 bg-slate-50">${formatCOP.format(flujoNeto)}</td>
                    <td class="p-3 font-bold ${acumulado < 0 ? 'text-red-500' : 'text-blue-600'}">${formatCOP.format(acumulado)}</td>
                </tr>`;
            }

            // Calculo de % Ahorro
            let pctAhorro = 0;
            if (facturaActual1 > 0) pctAhorro = (facturaActual1 - facturaNueva1) / facturaActual1;
            document.getElementById('valPctAhorro').innerText = (pctAhorro * 100).toFixed(1) + '%';

            // Render UI
            document.getElementById('resPotencia').innerText = potInstaladaKw.toFixed(2) + " kWp";
            document.getElementById('resPaneles').innerText = numPaneles;
            // document.getElementById('resInversion').innerText = formatCOP.format(inversion); // Element removed
            document.getElementById('resPayback').innerText = payback > 0 ? payback.toFixed(1) + " Años" : ">25";

            let tir = calculateIRR([-equity, ...flujos.slice(1)]); // TIR sobre Equity
            document.getElementById('resTIR').innerText = (tir * 100).toFixed(1) + "% E.A.";
            document.getElementById('tablaBody').innerHTML = htmlTabla;

            // Ambiental
            let energiaVida = 0; for (let i = 1; i <= 25; i++) energiaVida += genAnual * Math.pow(0.9945, i - 1);
            document.getElementById('resCO2').innerText = ((energiaVida * 0.2) / 1000).toFixed(1);
            document.getElementById('resArboles').innerText = Math.round(((energiaVida * 0.2) / 1000) * 7.8);

            // Factura
            document.getElementById('valAutoconsumo').innerText = formatCOP.format(ahorroMes1Auto);
            document.getElementById('valExcedentes').innerText = formatCOP.format(ahorroMes1Exc);
            document.getElementById('valAhorroTotal').innerText = formatCOP.format(ahorroMes1Auto + ahorroMes1Exc);
            document.getElementById('valFacturaActual').innerText = formatCOP.format(facturaActual1);
            document.getElementById('valFacturaNueva').innerText = formatCOP.format(facturaNueva1);

            updateCharts(Array.from({ length: 26 }, (_, i) => `Año ${i}`), dataAcum, facturaNueva1, ahorroMes1Auto, ahorroMes1Exc);
        }

        function updateCharts(labels, data, fNueva, ahAuto, ahExc) {
            const ctxFlujo = document.getElementById('chartFlujo').getContext('2d');
            if (chartFlujoInstance) chartFlujoInstance.destroy();
            chartFlujoInstance = new Chart(ctxFlujo, {
                type: 'line',
                data: { labels: labels, datasets: [{ label: 'Flujo Acumulado', data: data, borderColor: '#16a34a', backgroundColor: 'rgba(22, 163, 74, 0.2)', fill: true, tension: 0.4, pointRadius: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { callback: v => '$' + v / 1000000 + 'M' } }, x: { grid: { display: false } } } }
            });

            const ctxFactura = document.getElementById('chartFactura').getContext('2d');
            if (chartFacturaInstance) chartFacturaInstance.destroy();
            chartFacturaInstance = new Chart(ctxFactura, {
                type: 'doughnut',
                data: { labels: ['A Pagar a la Red', 'Ahorro Autoconsumo', 'Excedentes'], datasets: [{ data: [fNueva, ahAuto, ahExc], backgroundColor: ['#e2e8f0', '#2563eb', '#f97316'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 10 } } } } }
            });
        }

        function printPage() {
            window.print();
        }

        window.onload = function () { generateId(); toggleFinanciamiento(); };
    </script>

    <!-- Footer Profesional -->
    <footer class="no-print"
        style="background: linear-gradient(to bottom, #0F172A, #020617); color: #94a3b8; padding: 3rem 5% 1.5rem; border-top: 2px solid #F59E0B; margin-top: 3rem;">
        <div
            style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
            <!-- Columna 1: Contacto -->
            <div>
                <h4
                    style="color: #F59E0B; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; letter-spacing: 1px;">
                    Contacto</h4>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><i class="fas fa-envelope"
                        style="color: #F59E0B; margin-right: 8px; width: 16px;"></i> <a
                        href="mailto:ingenieria@tecsole.com"
                        style="color: #94a3b8; text-decoration: none;">ingenieria@tecsole.com</a></p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><i class="fas fa-phone"
                        style="color: #F59E0B; margin-right: 8px; width: 16px;"></i> <a href="tel:+573054345190"
                        style="color: #94a3b8; text-decoration: none;">+57 305 4345190</a></p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><i class="fab fa-whatsapp"
                        style="color: #F59E0B; margin-right: 8px; width: 16px;"></i> <a
                        href="https://wa.me/573054345190" target="_blank" rel="noopener"
                        style="color: #94a3b8; text-decoration: none;">WhatsApp</a></p>
            </div>

            <!-- Columna 2: Enlaces Rápidos -->
            <div>
                <h4
                    style="color: #F59E0B; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; letter-spacing: 1px;">
                    Link</h4>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><a href="index.html"
                        style="color: #94a3b8; text-decoration: none; transition: color 0.3s;">Página Principal</a></p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><a href="index.html#perfil"
                        style="color: #94a3b8; text-decoration: none; transition: color 0.3s;">Perfil Profesional</a>
                </p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><a href="index.html#experiencia"
                        style="color: #94a3b8; text-decoration: none; transition: color 0.3s;">Proyectos Destacados</a>
                </p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;"><a
                        href="Manual_Usuario_SolarExpert.pdf" download
                        style="color: #94a3b8; text-decoration: none; transition: color 0.3s;">Manual de Uso</a></p>
            </div>

            <!-- Columna 3: Servicios -->
            <div>
                <h4
                    style="color: #F59E0B; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; letter-spacing: 1px;">
                    Servicios</h4>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;">• Ingeniería Eléctrica</p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;">• Energía Solar Fotovoltaica</p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;">• Análisis de Datos</p>
                <p style="margin: 0.5rem 0; font-size: 0.85rem; line-height: 1.8;">• Consultoría Técnica</p>
            </div>

            <!-- Columna 4: Redes Sociales -->
            <div>
                <h4
                    style="color: #F59E0B; font-family: 'Montserrat', sans-serif; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1rem; letter-spacing: 1px;">
                    Sígueme</h4>
                <div style="display: flex; gap: 1rem; font-size: 1.5rem; margin-top: 1rem;">
                    <a href="https://www.linkedin.com/in/yorman-peralta-garcia/" target="_blank" rel="noopener"
                        aria-label="LinkedIn" style="color: #94a3b8; transition: color 0.3s;"><i
                            class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>

        <!-- Copyright -->
        <div
            style="border-top: 1px solid #1e293b; padding-top: 1.5rem; text-align: center; font-size: 0.75rem; color: #64748B;">
            <p style="margin: 0;">&copy; 2025 Yorman Peralta García - Ingeniero Electricista | Matrícula Profesional |
                Todos los derechos reservados.</p>
        </div>
    </footer>

</body>


</html>